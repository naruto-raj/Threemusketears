<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="../static/css/styles.css">
</head>
<body>

  <div class="video-container">
    <video autoplay loop muted>
      <source src="{{ url_for('static', filename=video_url) }}" type="video/mp4">
      <source src="data:video/mp4;base64,{{ base64_video_data }}" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </div>

  <div class="overlay-text">
    <p id="text"></p>
    <div class="input-container" id="inputContainer">
      <form action="/submit" method="post" onsubmit="showLoading()">
        <input type="text" name="text_prompt" placeholder="What do you pick...">
      </form>
    </div>
  </div>
  <div id="loading" style="display: none;">
    <object type="image/svg+xml" data="{{ url_for('static', filename='loading.svg') }}" width="40px" height="40px">
      <!-- Fallback text or image if SVG is not supported -->
      Loading...
    </object>
      <p id="loading-message"></p>
  </div>

  <script>
    const textElement = document.getElementById('text');
    const textContent = "{{ initial_text_content }}";
    const loadingMessages = [
      "Great choice! Adventure awaits...",
      "Prepare yourself for a journey into the unknown...",
      "The realm of dragons awaits your courage...",
      "Fortune favors the bold. Are you ready to seize it?",
      "Brace yourself! The quest is about to begin...",
      "Patience, brave hero. Your destiny awaits...",
      "Unlock the secrets of a world filled with wonder...",
      "Embark on an epic quest to save the kingdom...",
      "Gather your allies and face the challenges ahead...",
      "The tavern is bustling with tales of your exploits...",
      "May your blade be sharp and your spells be true..."
    ];
    let index = 0;
    let i=0;
    let textAnimation = null;
    let loadingMessageIndex = 0;

    function displayText() {
      textElement.textContent += textContent[index];
      index++;
      if (index < textContent.length) {
        textAnimation = setTimeout(displayText, 100);
      } else {
        document.getElementById('inputContainer').style.display = 'block';
        // document.getElementById('text_prompt').focus();
      }
    }

    function stopAnimation() {
      clearTimeout(textAnimation);
    }

    function showLoading() {
      document.getElementById("loading").style.display = "flex";
      const loadingMessageElement = document.getElementById('loading-message');

      loadingMessages.forEach((message, i) => {
        setTimeout(() => {
          let index = 0;
          let animatedMessage = ''; // Temporary string to hold animated message

          function animateLetters() {
            const letterAnimation = setInterval(() => {
              if (index < message.length) {
                animatedMessage += message[index]; // Append current letter to animatedMessage
                loadingMessageElement.textContent = animatedMessage; // Update textContent
                index++;
              } else {
                clearInterval(letterAnimation); // Stop animation when all letters are displayed
              }
            }, 100); // Adjust the delay as needed
          }

          animateLetters(); // Start animating letters for the current message
        }, i * 5000); // Delay each message by 5 seconds, adjust as needed
      });
    }

    function stopAnimation() {
      clearTimeout(textAnimation);
    }

    displayText();
  </script>
  <script>
    document.getElementById("myForm").addEventListener("submit", function() {
      setTimeout(hideLoading, 2000); // Hide loading after 2 seconds (adjust as needed)
    });
  </script>
</body>
</html>
